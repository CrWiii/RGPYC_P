<style type="text/css">
	table > tbody > tr > td {
		vertical-align: middle !important;
		text-align:center;
		padding-bottom: 4px !important;
		padding-top: 4px !important;
	}
</style>
<table id="nom"  width="100%" border="0" cellpadding="0" cellspacing="0" class="table table-bordered" style="white-space: nowrap;font-size: 11px !important">
	<thead>
		<tr style="background-color: #eff3f5 !important;color:#5c6a71 !important;">
			<th style="text-align:center;padding-bottom: 4px;padding-top: 4px;width: 50px">
				<a id="sorter" data-cont="num_ajuste" style="cursor: pointer !important;">N° Ajuste
					<i id="sort" data-cont="num_ajuste"  style="font-size: 11px;padding-top: 2px;cursor: pointer !important; display: none;" class="fa fa-long-arrow-down"></i>
				</a>
			</th>
			<th style="text-align:center;padding-bottom: 4px;padding-top: 4px;width: 90px;padding-left: 4px;">
				<a id="sorter" data-cont="cia_id" style="cursor: pointer !important;">Aseguradora 
					<i id="sort" data-cont="cia_id"  style="font-size: 11px;padding-top: 2px;cursor: pointer !important; display: none;" class="fa fa-arrows-v"></i>
				</a>
			</th>
			<th style="text-align:center;padding-bottom: 4px;padding-top: 4px;width: 50px;padding-left: 4px;" >
				<a id="sorter" data-cont="num_siniestro_cia" style="cursor: pointer !important;">N° Siniestro
					<i id="sort" data-cont="num_siniestro_cia"  style="font-size: 11px;padding-top: 2px; display: none;" class="fa fa-arrows-v"></i>
				</a>
			</th>
			<th style="text-align:center;padding-bottom: 4px;padding-top: 4px;width: 75px;padding-left: 4px;" >
				<a  id="sorter" data-cont="broker_id" style="cursor: pointer !important;">Broker
					<i id="sort" data-cont="broker_id"  style="font-size: 11px;padding-top: 2px; display: none;" class="fa fa-arrows-v"></i>
				</a>
			</th>
			<th style="text-align:center;padding-bottom: 4px;padding-top: 4px;width: 50px;padding-left: 4px;" >
				<a  id="sorter" data-cont="num_siniestro_broker" style="cursor: pointer !important;">N° Broker
					<i id="sort" data-cont="num_siniestro_broker"  style="font-size: 11px;padding-top: 2px; display: none;" class="fa fa-arrows-v"></i>
				</a>
			</th>
			<th style="text-align:center;padding-bottom: 4px;padding-top: 4px;width: 95px;" >
				<a  id="sorter" data-cont="asegurado_name" style="cursor: pointer !important;">Asegurado
					<i id="sort" data-cont="asegurado_name"  style="font-size: 11px;padding-top: 2px; display: none;" class="fa fa-arrows-v"></i>
				</a>
			</th>
			<th style="text-align:center;padding-bottom: 4px;padding-top: 4px;width: 85px">
				<a id="sorter" data-cont="ramo_id" style="cursor: pointer !important;">Ramo
					<i id="sort" data-cont="ramo_id"  style="font-size: 11px;padding-top: 2px;cursor: pointer !important; display: none;" class="fa fa-arrows-v"></i>
				</a>
			</th>
			<th style="text-align:center;padding-bottom: 4px;padding-top: 4px;width: 50px;">
				<a  id="sorter" data-cont="num_poliza" style="cursor: pointer !important;">N° Poliza
					<i id="sort" data-cont="num_poliza"  style="font-size: 11px;padding-top: 2px;cursor: pointer !important; display: none;" class="fa fa-arrows-v"></i>
				</a>
			</th>
			<th style="text-align:center;padding-bottom: 4px;padding-top: 4px;width: 50px">
				<a  id="sorter" data-cont="fecha_siniestro" style="cursor: pointer !important;">F. Siniestro
					<i id="sort" data-cont="fecha_siniestro"  style="font-size: 11px;padding-top: 2px;cursor: pointer !important; display: none;" class="fa fa-arrows-v"></i>
				</a>
			</th>
			
			<th style="text-align:center;padding-bottom: 4px;padding-top: 4px;width: 50px">
				<a  id="sorter" data-cont="notifier_date" style="cursor: pointer !important;">F. Encargo
					<i id="sort" data-cont="notifier_date"  style="font-size: 11px;padding-top: 2px;cursor: pointer !important; display: none;" class="fa fa-arrows-v"></i>
				</a>
			</th>
			<th style="text-align:center;padding-bottom: 4px;padding-top: 4px;width: 70px">
				<a  id="sorter" data-cont="moneda" style="cursor: pointer !important;">Moneda
					<i id="sort" data-cont="moneda"  style="font-size: 11px;padding-top: 2px;cursor: pointer !important;display: none;" class="fa fa-arrows-v"></i>
				</a>
			</th>
			<th style="text-align:center;padding-bottom: 4px;padding-top: 4px;width: 70px">
				<a  id="sorter" data-cont="monto_reclamo" style="cursor: pointer !important;">M. Reclamado
					<i id="sort" data-cont="monto_reclamo"  style="font-size: 11px;padding-top: 2px;cursor: pointer !important; display: none;" class="fa fa-arrows-v"></i>
				</a>
			</th>
			<th style="text-align:center;padding-bottom: 4px;padding-top: 4px; width: 60px">
				<a  id="sorter" data-cont="reserva_inicial" style="cursor: pointer !important;">Reserva Neta
					<i id="sort" data-cont="reserva_inicial"  style="font-size: 11px;padding-top: 2px;cursor: pointer !important; display: none;" class="fa fa-arrows-v"></i>
				</a>
			</th>
			<th style="text-align:center;padding-bottom: 4px;padding-top: 4px;width: 30px">
				<a  id="sorter" data-cont="notifier_date" style="cursor: pointer !important;">Dias
					<i id="sort" data-cont="notifier_date"  style="font-size: 11px;padding-top: 2px;cursor: pointer !important; display: none;" class="fa fa-arrows-v"></i>
				</a>
			</th>
			<th style="text-align:center;padding-bottom: 4px;padding-top: 4px;width: 80px">
				<a  id="sorter" data-cont="fecha_iforme_final" style="cursor: pointer !important;">Ultimo Informe
					<i id="sort" data-cont="fecha_iforme_final"  style="font-size: 11px;padding-top: 2px;cursor: pointer !important; display: none;" class="fa fa-arrows-v"></i>
				</a>
			</th>
			<th style="text-align:center;padding-bottom: 4px;padding-top: 4px;width: 100px">
				<a  id="sorter" data-cont="estado_id" style="cursor: pointer !important;">Estado
					<i id="sort" data-cont="estado_id" style="font-size: 11px;padding-top: 2px;cursor: pointer !important; display: none;" class="fa fa-arrows-v"></i>
				</a>
			</th>
		</tr>
	</thead>
	<tbody>
		<?php use Carbon\Carbon; ?>
		@foreach($Casos as $Caso)
		<tr>
			<td data-label="N° Ajuste:"><a href="{{url('DetallesCaso',array($Caso->id))}}" data-widget="" data-toggle="tooltip" title="@if(!empty($Caso->Ajustador)){{$Caso->Ajustador->search}} @endif">{{$Caso->num_ajuste}}</a></td>
			<td data-label="Aseguradora:" style="text-align: left"><i data-toggle="tooltip" title="{{$Caso->ejecutivo_aseguradora_name}}">@if(!empty($Caso->Cia)){{$Caso->Cia->nombre_comercial}} @endif</i></td> 
			<td data-label="N° Siniestro:" style="text-align: left !important;">{{$Caso->num_siniestro_cia}}</td>
			<td data-label="Broker:" style="text-align: left"><i data-toggle="tooltip" title="{{$Caso->ejecutivo_broker_name}}">@if(!empty($Caso->broker)){{$Caso->broker->description}} @endif</i></td>
			<td data-label="N° Broker:" style="text-align: left !important">{{$Caso->num_siniestro_broker}}</td>
			<td data-label="Asegurado:" style="text-align: left">{{$Caso->asegurado_name}}</td>
			<td data-label="Ramo:" style="text-align: left">@if(!empty($Caso->Ramo)){{$Caso->Ramo->description}}@endif</td>
			<td data-label="N° Poliza:" style="text-align: left !important;">{{$Caso->num_poliza}}</td>
			<td data-label="F. Siniestro:">@if(!empty($Caso->fecha_siniestro)){{date('d/m/Y', strtotime($Caso->fecha_siniestro))}}@endif</td>
			<td data-label="F. Encargo:">@isset($Caso->notifier_date){{date('d/m/Y', strtotime($Caso->notifier_date))}}@endisset</td>
			<td data-label="Moneda">@isset($Caso->moneda) @if($Caso->moneda=='SOLES') S/. @ELSE U$S @endif @endisset</td>
			<td data-label="M. Reclamado:" style="text-align: right;">{{number_format($Caso->monto_reclamo,2)}}</td>
			<td data-label="Reserva Neta:" style="text-align: right;">@isset($Caso->reserva_inicial){{number_format($Caso->reserva_inicial,2)}}@endisset</td>
			<td data-label="Días:">@isset($Caso->notifier_date){{ Carbon::now()->diffInDays(Carbon::parse($Caso->notifier_date)) }}@endisset</td>
			<td data-label="Ultimo Informe:">
				@if(!empty($Caso->Informe()->first()->generated_at))
				{{$Caso->Informe()->orderBy('created_at', 'desc')->first()->num_informe}}
				@endif
			</td>
			<!-- $dtOttawa = Carbon::createFromDate(2000, 1, 1, 'America/Toronto'); -->
			<!-- $dtVancouver = Carbon::createFromDate(2000, 1, 1, 'America/Vancouver'); -->
			<!-- $dtOttawa->diffInHours($dtVancouver, false) -->
			<!-- if(!empty($Caso->notifier_date))$cd = date('Y-m-d H:i:s', strtotime($Caso->notifier_date)) -->
			<?php 
			$CWN_REG = null;
			if($Caso->notifier_date !== null){
				$FNO = Carbon::parse(date('Y-m-d H:i:s', strtotime($Caso->notifier_date)));
			}else{$FNO = null;}

			if($Caso->fecha_programada_inspeccion !==null){
				$FPI = Carbon::parse(date('Y-m-d H:i:s', strtotime($Caso->fecha_programada_inspeccion)));
			}else{$FPI = null;}

			if($FPI !== null && $FNO !== null){
				$DIFF_REG = $FPI->diffInHours($FNO);
			}else{$DIFF_REG = null;}

			if($FPI === null && $FNO !== null){
				$CWN_REG = $FNO->diffInHours();
			}
			?>
			<?php
			$CWN_INS = null;
			if($Caso->fecha_iforme_final !== null){
				$FIF = Carbon::parse(date('Y-m-d H:i:s', strtotime($Caso->fecha_iforme_final)));
			}else{$FIF = null;}
			if($FPI !== null && $FIF !== null){
				$DIFF_INS = $FIF->diffInHours($FPI);
			// }else if($FPI !== null && $FIF !== null && $DIFF_INS == null){
				// $DIFF_INS = $FIF->diffInSeconds($FPI);
				// $DIFF_INS = gmdate('H:i:s', $DIFF_INS);
			}else{$DIFF_INS = null;}
			if($FIF === null && $FPI !== null){
				$CWN_INS = $FPI->diffInHours();
			}

			
			?>
			<!-- <p @if($DIFF_REG> 24) style="background-color: red !important;"@endif>
											@isset($DIFF_REG) DIFF: {{$DIFF_REG}} | @endisset
											@isset($CWN_REG) CWN: {{$CWN_REG}} | @endisset
											@isset($FPI) FI: {{$FPI}} | @endisset
											@isset($FNO) FN: {{$FNO}} | @endisset
										</p> -->
										<!-- fecha_programada_inspeccion <<<< si esto esta en blanco rojo -->
										<!-- si el check de sin_inspeccion es true no pasar por la validacion de colores -->
										<!-- {{$Caso->created_at}} <br>
										{{$Caso->notifier_date}} -->
			<td data-label="Estado:" style="text-align: left !important">
			<!-- @isset($DIFF_REG) han pasado {{$DIFF_REG}} horas entre la fecha notificación y inspección  @endisset - {{$CWN_INS}}-->
				<i data-toggle="tooltip" title="
				@if($Caso->estado_id == 1)
				@isset($CWN_REG) han pasado {{$CWN_REG}} horas desde la fecha de notificación @endisset 
				@endif
				@if($Caso->estado_id == 2)
					@if($DIFF_INS>$CWN_INS)
						@isset($DIFF_INS) han pasado {{$DIFF_INS}} horas de  diferencia entre la inspección y fin inspección  @endisset
					@elseif($DIFF_INS == 0)
						la diferencia de horas entre la inspección y fin inspección es menor a una hora
					@else
						@isset($CWN_INS) han pasado {{$CWN_INS}} horas de la fecha de inspección @endisset 
					@endif
					
				@endif
				">
				<span>
					<?php 
						switch ($Caso->estado_id) {
							case 1:
								if($CWN_REG){
									if($CWN_REG >= 12 && $CWN_REG <= 24){
										echo '<i class="fa fa-circle" style="color:#ff7701 !important"></i>';
									}elseif($CWN_REG >= 24){ 
										echo '<i class="fa fa-circle" style="color:#dd4b39 !important"></i>';
									}elseif($CWN_REG <= 12)
										echo '<i class="fa fa-circle" style="color:#00a65a !important"></i>';
								}
								if($DIFF_REG){
									if($DIFF_REG >= 12 && $DIFF_REG <= 24){
										echo '<i class="fa fa-circle" style="color:#ff7701 !important"></i>';
									}elseif($DIFF_REG >= 24){
										echo '<i class="fa fa-circle" style="color:#dd4b39 !important"></i>';
									}elseif($DIFF_REG <= 12){
										echo '<i class="fa fa-circle" style="color:#00a65a !important"></i>';
									}

								}
								if($CWN_REG == null && $DIFF_REG == null){
									echo '<i class="fa fa-circle" style="color:#dd4b39 !important"></i>';
								}
							break;

							case 2:
								if($CWN_INS){
									if($CWN_INS >= 12 && $CWN_INS <= 24){
										echo '<i class="fa fa-circle" style="color:#ff7701 !important"></i>';
									}elseif($CWN_INS >= 24){
										echo '<i class="fa fa-circle" style="color:#dd4b39 !important"></i>';
									}elseif($CWN_INS <= 12){
										echo '<i class="fa fa-circle" style="color:#00a65a !important"></i>';
									}
								}
								if($DIFF_INS){
									if($DIFF_INS >= 12 && $DIFF_INS <= 24){
										echo '<i class="fa fa-circle" style="color:#ff7701 !important"></i>';
									}elseif($DIFF_INS >= 24){
										echo '<i class="fa fa-circle" style="color:#dd4b39 !important"></i>';
									}elseif($DIFF_INS <= 12 || $DIFF_INS==0){
										echo '<i class="fa fa-circle" style="color:#00a65a !important"></i>';
									}
								}

								if($CWN_INS == null && $DIFF_INS == null){
									echo '<i class="fa fa-circle" style="color:#dd4b39 !important"></i>';
								}
							break;

							case 3:
								echo '<i class="fa fa-circle" style="color:#00a65a !important"></i>';
							break;

							case 4:
								echo '<i class="fa fa-circle" style="color:#000000 !important"></i>';
							break;

							case 5:
								echo '<i class="fa fa-circle" style="color:#00a65a !important"></i>';
							break;

							case 6:
								echo '<i class="fa fa-circle" style="color:#00a65a !important"></i>';
							break;

							case 7:
								echo '<i class="fa fa-circle" style="color:#286090 !important"></i>';
							break;
						}
					?>
					<span style="padding-left: 10px !important">@if(!empty($Caso->Estado)){{$Caso->Estado->description}}@endif</span>
				</span>
			</td>

		</tr>
		@endforeach
	</tbody>
</table>
<input type="hidden" id="TotResultCases" value="{{$TotResultCases}}">
<div class="box-footer clearfix" style="text-align: center;padding: 0px !important;">
	<div id="pagi" >
		{!! $Casos->render() !!}
	</div>
	<style type="text/css">
		.pagination{margin-top: 5px !important;margin-bottom: 5px !important;}
	</style>
</div>

<!--
SI EL CHECK DE SIN_INSPECCION ES FALSE >

caso en inspeccion se compara cona la fecha fin de inspeccion si la diff es mayor a 24 horas se pinta de rojo 
si tiene fecha de inspeccion y no tiene fecha fecha_iforme_final comparar contra la 

fecha de hoy y validar que no sea mayor a 24 horas 

semaforo
[*] 12 horas naranja 
si la diff de horas sea mayor a 24 ROJO 

sino tiene fecha de inspeccion y si la diff de horas sea mayor a 24 ROJO 

si hay fecha de notificacion pero no hay fecha de inspeccion comparar contra fecha actual > si paso mas de 24 horas ROJO estado

SI HAY FECHA DE INSPECCION REGISTRADA EL ESTADO CAMBIA A EN INSPECCION

si fecha_iforme_final diff null el estado cambia CON INFORME BASICO
-->